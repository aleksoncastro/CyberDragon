<div class="payment-container">
  <!-- Header -->
  <div class="payment-header">
    <h1 class="payment-title">Finalizar Pedido</h1>
    <p class="payment-subtitle">Revise seus itens e complete o pagamento</p>
  </div>

  <div class="payment-content">
    <!-- Resumo do Pedido -->
    <div class="order-summary">
      <h2 class="section-title">
        <i class="icon-cart">üõí</i>
        Resumo do Pedido
      </h2>
      
      <div class="cart-items" *ngIf="carrinhoItens.length > 0">
        <div class="cart-item" *ngFor="let item of carrinhoItens; let i = index">
          <div class="item-info">
            <h3 class="item-name">{{ item.modelo }}</h3>
            <div class="item-details">
              <span class="item-quantity">Qtd: {{ item.quantidade }}</span>
              <span class="item-unit-price">Unit: R$ {{ item.preco.toFixed(2) }}</span>
            </div>
          </div>
          <div class="item-price">
            <span class="price">R$ {{ (item.preco * item.quantidade).toFixed(2) }}</span>
          </div>
        </div>
      </div>

      <div class="cart-empty" *ngIf="carrinhoItens.length === 0">
        <div class="empty-icon">üõí</div>
        <p>Seu carrinho est√° vazio</p>
        <small>Adicione produtos para continuar</small>
      </div>

      <div class="order-total" *ngIf="carrinhoItens.length > 0">
        <div class="total-breakdown">
          <div class="total-row subtotal">
            <span class="total-label">Subtotal ({{ carrinhoItens.length }} {{ carrinhoItens.length === 1 ? 'item' : 'itens' }}):</span>
            <span class="total-value">R$ {{ calcularTotal().toFixed(2) }}</span>
          </div>
          <div class="total-row shipping">
            <span class="total-label">Frete:</span>
            <span class="total-value free">Gr√°tis</span>
          </div>
        </div>
        <div class="final-total">
          <div class="total-row">
            <span class="total-label">Total:</span>
            <span class="total-value">R$ {{ calcularTotal().toFixed(2) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Formul√°rio de Pagamento -->
    <div class="payment-form-container">
      <form [formGroup]="pagamentoForm" (ngSubmit)="confirmarPagamento()" class="payment-form">
        
        <!-- Sele√ß√£o de Endere√ßo -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="icon-location">üìç</i>
            Endere√ßo de Entrega
          </h2>
          
          <div class="form-group">
            <label for="endereco" class="form-label">Selecione o endere√ßo de entrega:</label>
            <div class="select-wrapper">
              <select 
                id="endereco" 
                formControlName="enderecoId" 
                class="form-select"
                [class.error]="pagamentoForm.get('enderecoId')?.invalid && pagamentoForm.get('enderecoId')?.touched">
                <option value="">Escolha um endere√ßo</option>
                <option *ngFor="let endereco of enderecos" [value]="endereco.id">
                  {{ endereco.rua }}, {{ endereco.numero }} - {{ endereco.bairro }}
                  <br>{{ endereco.cidade }}/{{ endereco.estado }} - CEP: {{ endereco.cep }}
                </option>
              </select>
            </div>
            <div class="error-message" *ngIf="pagamentoForm.get('enderecoId')?.invalid && pagamentoForm.get('enderecoId')?.touched">
              <span class="error-icon">‚ö†Ô∏è</span>
              Por favor, selecione um endere√ßo de entrega
            </div>
            
            <!-- Endere√ßo Selecionado Preview -->
            <div class="selected-address" *ngIf="pagamentoForm.get('enderecoId')?.value">
              <div class="address-preview">
                <h4>Endere√ßo selecionado:</h4>
                <div class="address-details" *ngFor="let endereco of enderecos">
                  <div *ngIf="endereco.id == pagamentoForm.get('enderecoId')?.value">
                    <p><strong>{{ endereco.rua }}, {{ endereco.numero }}</strong></p>
                    <p>{{ endereco.bairro }} - {{ endereco.cidade }}/{{ endereco.estado }}</p>
                    <p>CEP: {{ endereco.cep }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- M√©todo de Pagamento -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="icon-payment">üí≥</i>
            M√©todo de Pagamento
          </h2>
          
          <div class="payment-methods">
            <div class="payment-option">
              <input 
                type="radio" 
                id="pix" 
                formControlName="tipoPagamento" 
                value="1" 
                class="payment-radio">
              <label for="pix" class="payment-label">
                <div class="payment-icon pix-icon">PIX</div>
                <div class="payment-info">
                  <h3>PIX</h3>
                  <p>Pagamento instant√¢neo e seguro</p>
                  <small class="payment-benefit">‚úì Aprova√ß√£o imediata</small>
                </div>
                <div class="payment-badge instant">Instant√¢neo</div>
              </label>
            </div>

            <div class="payment-option">
              <input 
                type="radio" 
                id="boleto" 
                formControlName="tipoPagamento" 
                value="2" 
                class="payment-radio">
              <label for="boleto" class="payment-label">
                <div class="payment-icon boleto-icon">BOL</div>
                <div class="payment-info">
                  <h3>Boleto Banc√°rio</h3>
                  <p>Pague em qualquer banco ou lot√©rica</p>
                  <small class="payment-benefit">‚úì Vencimento em 3 dias √∫teis</small>
                </div>
                <div class="payment-badge traditional">Tradicional</div>
              </label>
            </div>

            <div class="payment-option">
              <input 
                type="radio" 
                id="cartao" 
                formControlName="tipoPagamento" 
                value="3" 
                class="payment-radio">
              <label for="cartao" class="payment-label">
                <div class="payment-icon cartao-icon">üí≥</div>
                <div class="payment-info">
                  <h3>Cart√£o de Cr√©dito</h3>
                  <p>Parcelamento em at√© 12x sem juros</p>
                  <small class="payment-benefit">‚úì Prote√ß√£o contra fraude</small>
                </div>
                <div class="payment-badge flexible">Flex√≠vel</div>
              </label>
            </div>
          </div>

          <div class="error-message" *ngIf="pagamentoForm.get('tipoPagamento')?.invalid && pagamentoForm.get('tipoPagamento')?.touched">
            <span class="error-icon">‚ö†Ô∏è</span>
            Por favor, selecione um m√©todo de pagamento
          </div>
        </div>

        <!-- Informa√ß√µes Adicionais do Pagamento -->
        <div class="payment-details" *ngIf="pagamentoForm.get('tipoPagamento')?.value">
          <div class="payment-info-card">
            <div *ngIf="pagamentoForm.get('tipoPagamento')?.value === '1'" class="pix-info">
              <h4>üîí Pagamento via PIX</h4>
              <ul>
                <li>Ap√≥s confirmar, voc√™ receber√° o QR Code</li>
                <li>Escaneie com o app do seu banco</li>
                <li>Pagamento processado instantaneamente</li>
              </ul>
            </div>
            
            <div *ngIf="pagamentoForm.get('tipoPagamento')?.value === '2'" class="boleto-info">
              <h4>üìÑ Pagamento via Boleto</h4>
              <ul>
                <li>Boleto ser√° enviado por email</li>
                <li>Pague em qualquer banco ou app</li>
                <li>Prazo de vencimento: 3 dias √∫teis</li>
              </ul>
            </div>
            
            <div *ngIf="pagamentoForm.get('tipoPagamento')?.value === '3'" class="cartao-info">
              <h4>üí≥ Pagamento via Cart√£o</h4>
              <ul>
                <li>Aceitamos Visa, Mastercard e Elo</li>
                <li>Parcelamento sem juros dispon√≠vel</li>
                <li>Dados protegidos com criptografia</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Resumo Final -->
        <div class="order-confirmation" *ngIf="carrinhoItens.length > 0">
          <div class="confirmation-details">
            <h3>Confirma√ß√£o do Pedido</h3>
            <div class="confirmation-row">
              <span>Itens:</span>
              <span>{{ carrinhoItens.length }} {{ carrinhoItens.length === 1 ? 'produto' : 'produtos' }}</span>
            </div>
            <div class="confirmation-row">
              <span>Valor Total:</span>
              <span class="highlight">R$ {{ calcularTotal().toFixed(2) }}</span>
            </div>
            <div class="confirmation-row" *ngIf="pagamentoForm.get('tipoPagamento')?.value">
              <span>Pagamento:</span>
              <span>
                {{ pagamentoForm.get('tipoPagamento')?.value === '1' ? 'PIX' : 
                   pagamentoForm.get('tipoPagamento')?.value === '2' ? 'Boleto' : 'Cart√£o de Cr√©dito' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Bot√£o de Confirma√ß√£o -->
        <div class="form-actions">
          <button 
            type="submit" 
            class="btn-confirm"
            [disabled]="pagamentoForm.invalid || carrinhoItens.length === 0">
            <div class="btn-content">
              <span class="btn-icon">üîí</span>
              <div class="btn-text-container">
                <span class="btn-text">Finalizar Pedido</span>
                <span class="btn-amount">R$ {{ calcularTotal().toFixed(2) }}</span>
              </div>
            </div>
          </button>
          
          <div class="security-info">
            <small>
              <span class="security-icon">üõ°Ô∏è</span>
              Seus dados est√£o protegidos com criptografia SSL
            </small>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
