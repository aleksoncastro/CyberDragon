<div class="wrapper">
  <div class="container">
    <form [formGroup]="formGroup" (ngSubmit)="onSubmit()">

      <div class="form-container">
        <div class="form-box">

          <mat-toolbar color="primary" class="toolbar-title">
            Cadastro de Usuário
          </mat-toolbar>

          <!-- Username -->
<mat-form-field appearance="fill">
  <mat-label>Username</mat-label>
  <input matInput type="text" formControlName="username">
  <mat-error *ngIf="formGroup.get('username') && formGroup.get('username')?.invalid && formGroup.get('username')?.touched">
    {{ getErrorMessage('username', formGroup.get('username')?.errors) }}
    @if (formGroup.get('username')?.hasError('apiError')) {
      <span>{{ formGroup.get('username')?.getError('apiError') }}</span>
    }
  </mat-error>
</mat-form-field>

<!-- Email -->
<mat-form-field appearance="fill">
  <mat-label>Email</mat-label>
  <input matInput type="email" formControlName="email">
  <mat-error *ngIf="formGroup.get('email') && formGroup.get('email')?.invalid && formGroup.get('email')?.touched">
    {{ getErrorMessage('email', formGroup.get('email')?.errors) }}
    @if (formGroup.get('email')?.hasError('apiError')) {
      <span>{{ formGroup.get('email')?.getError('apiError') }}</span>
    }
  </mat-error>
</mat-form-field>

<!-- CPF -->
<mat-form-field appearance="fill">
  <mat-label>CPF</mat-label>
  <input matInput type="text" formControlName="cpf">
  <mat-error *ngIf="formGroup.get('cpf') && formGroup.get('cpf')?.invalid && formGroup.get('cpf')?.touched">
    {{ getErrorMessage('cpf', formGroup.get('cpf')?.errors) }}
    @if (formGroup.get('cpf')?.hasError('apiError')) {
      <span>{{ formGroup.get('cpf')?.getError('apiError') }}</span>
    }
  </mat-error>
</mat-form-field>

<!-- Senha -->
<mat-form-field appearance="fill">
  <mat-label>Senha</mat-label>
  <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="senha">
  <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()">
    <mat-icon>{{ hidePassword ? 'visibility' : 'visibility_off' }}</mat-icon>
  </button>
  <mat-error *ngIf="formGroup.get('senha') && formGroup.get('senha')?.invalid && formGroup.get('senha')?.touched">
    {{ getErrorMessage('senha', formGroup.get('senha')?.errors) }}
    @if (formGroup.get('senha')?.hasError('apiError')) {
      <span>{{ formGroup.get('senha')?.getError('apiError') }}</span>
    }
  </mat-error>
</mat-form-field>

<!-- Confirmar Senha -->
<mat-form-field appearance="fill">
  <mat-label>Confirmar Senha</mat-label>
  <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmarSenha">
  <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPasswordVisibility()">
    <mat-icon>{{ hideConfirmPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
  </button>
  <mat-error *ngIf="formGroup.get('confirmarSenha')?.touched && 
                    (formGroup.get('confirmarSenha')?.invalid || formGroup.hasError('senhaNaoConfere'))">
    {{ getErrorMessage('confirmarSenha', formGroup.get('confirmarSenha')?.errors) || getConfirmPasswordErrorMessage() }}
    @if (formGroup.get('confirmarSenha')?.hasError('apiError')) {
      <span>{{ formGroup.get('confirmarSenha')?.getError('apiError') }}</span>
    }
  </mat-error>
</mat-form-field>

          <!-- Botão de Salvar -->
          <button mat-raised-button color="primary" type="submit" [disabled]="formGroup.invalid">
            Salvar
          </button>

        </div>
      </div>
    </form>
  </div>
</div>
